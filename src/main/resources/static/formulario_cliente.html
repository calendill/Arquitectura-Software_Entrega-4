<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Formulario Cliente</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background-color: #f8f9fa;
    }
    .form-container {
      max-width: 700px;
      margin: 50px auto;
      padding: 30px;
      background-color: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }
    h2 {
      text-align: center;
      margin-bottom: 25px;
      color: #343a40;
    }
    .btn-group-custom {
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }
    .btn-submit {
      width: 100%;
    }
  </style>
</head>
<body>

<div class="form-container">
  <h2 id="titulo">Nuevo Cliente</h2>

  <form id="formCliente">

    <div class="mb-3">
      <label class="form-label">C√©dula</label>
      <input type="text" id="cedula" class="form-control" placeholder="Ingrese la c√©dula" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Nombre</label>
      <input type="text" id="nombre" class="form-control" placeholder="Ingrese el nombre" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Primer Apellido</label>
      <input type="text" id="apellido1" class="form-control" placeholder="Ingrese el primer apellido" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Segundo Apellido</label>
      <input type="text" id="apellido2" class="form-control" placeholder="Ingrese el segundo apellido">
    </div>

    <div class="mb-3">
      <label class="form-label">Correo Electr√≥nico</label>
      <input type="email" id="correo" class="form-control" placeholder="ejemplo@correo.com" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Tel√©fono</label>
      <input type="text" id="telefono" class="form-control" placeholder="Ingrese el tel√©fono">
    </div>

    <div class="mb-3">
      <label class="form-label">Direcci√≥n</label>
      <input type="text" id="direccion" class="form-control" placeholder="Ingrese la direcci√≥n">
    </div>

    <div class="btn-group-custom mt-4">
      <a href="index.html" class="btn btn-secondary">üè† Volver al Inicio</a>
      <a href="listar_clientes.html" class="btn btn-info text-white">üìã Ver Lista de Clientes</a>
      <button type="submit" id="btnGuardar" class="btn btn-primary btn-submit">Guardar Cliente</button>
    </div>
  </form>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
  const API_URL = "http://localhost:9090/api/clientes"; // Ajusta seg√∫n tu backend

  async function cargarClienteSiExiste() {
    const params = new URLSearchParams(window.location.search);
    const cedula = params.get("cedula");

    if (cedula) {
      document.getElementById("titulo").textContent = "Editar Cliente";
      document.getElementById("btnGuardar").textContent = "Actualizar Cliente";

      try {
        const resp = await fetch(`${API_URL}/${cedula}`);
        if (!resp.ok) throw new Error("Cliente no encontrado");
        const cliente = await resp.json();

        // Llenar campos
        document.getElementById("cedula").value = cliente.cedula;
        document.getElementById("cedula").disabled = true;
        document.getElementById("nombre").value = cliente.nombre;
        document.getElementById("apellido1").value = cliente.apellido1;
        document.getElementById("apellido2").value = cliente.apellido2 || "";
        document.getElementById("correo").value = cliente.correo;
        document.getElementById("telefono").value = cliente.telefono || "";
        document.getElementById("direccion").value = cliente.direccion || "";
      } catch (error) {
        console.error("Error cargando cliente:", error);
        alert("Error al cargar el cliente.");
      }
    }
  }

  async function guardarCliente(event) {
    event.preventDefault();

    const cliente = {
      cedula: document.getElementById("cedula").value,
      nombre: document.getElementById("nombre").value,
      apellido1: document.getElementById("apellido1").value,
      apellido2: document.getElementById("apellido2").value,
      correo: document.getElementById("correo").value,
      telefono: document.getElementById("telefono").value,
      direccion: document.getElementById("direccion").value
    };

    const params = new URLSearchParams(window.location.search);
    const cedula = params.get("cedula");
    const method = cedula ? "PUT" : "POST";
    const url = cedula ? `${API_URL}/${cedula}` : `${API_URL}`;

    try {
      const response = await fetch(url, {
        method: method,
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(cliente)
      });

      if (response.ok) {
        alert("Cliente guardado correctamente.");
        window.location.href = "listar_clientes.html";
      } else {
        alert("Error al guardar el cliente.");
      }
    } catch (error) {
      console.error("Error al guardar cliente:", error);
      alert("Error al conectar con la API.");
    }
  }

  window.onload = () => {
    cargarClienteSiExiste();
    document.getElementById("formCliente").addEventListener("submit", guardarCliente);
  }
</script>
</body>
</html>
