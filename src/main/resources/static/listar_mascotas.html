<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Lista de Mascotas</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { background-color: #f8f9fa; }
    .container { margin-top: 50px; }
    h2 { text-align: center; margin-bottom: 30px; color: #343a40; }
    table {
      background-color: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }
  </style>
</head>
<body>

<div class="container">
  <h2>Lista de Mascotas</h2>
  <div class="mb-3 text-end">
    <a href="formulario_mascota.html" class="btn btn-primary">‚ûï Nueva Mascota</a>
  </div>

  <table class="table table-striped table-hover">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Nombre</th>
        <th>Tipo</th>
        <th>Raza / Color</th>
        <th>Sexo</th>
        <th>Pr√≥x. Vacunaci√≥n</th>
        <th>Cliente</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody id="tablaMascotas">
      <!-- Filas generadas por JS -->
    </tbody>
  </table>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
const API_URL = "http://localhost:9090/api";

// Cargar todas las mascotas
async function cargarMascotas() {
  try {
    const resp = await fetch(`${API_URL}/mascotas`);
    if (!resp.ok) throw new Error("Error al cargar mascotas");
    const mascotas = await resp.json();

    const tabla = document.getElementById("tablaMascotas");
    tabla.innerHTML = "";

    mascotas.forEach(m => {
      const fila = document.createElement("tr");

      const detalleTipo = m.tipoAnimal === "PERRO" ? m.raza || "" : m.colorPelaje || "";

      fila.innerHTML = `
        <td>${m.id}</td>
        <td>${m.nombre}</td>
        <td>${m.tipoAnimal}</td>
        <td>${detalleTipo}</td>
        <td>${m.sexo}</td>
        <td>${m.proximaFechaVacunacion || ''}</td>
        <td>${m.clienteNombre || ''}</td>
        <td>
          <a href="form_mascota.html?id=${m.id}" class="btn btn-sm btn-warning mb-1">‚úèÔ∏è Editar</a>
          <button class="btn btn-sm btn-danger" onclick="eliminarMascota(${m.id})">üóëÔ∏è Eliminar</button>
        </td>
      `;

      tabla.appendChild(fila);
    });

  } catch (error) {
    console.error(error);
    alert("Error al cargar mascotas.");
  }
}

// Eliminar mascota
async function eliminarMascota(id) {
  if (!confirm("¬øDesea eliminar esta mascota?")) return;

  try {
    const resp = await fetch(`${API_URL}/mascotas/${id}`, { method: "DELETE" });
    if (resp.ok) {
      alert("Mascota eliminada correctamente");
      cargarMascotas();
    } else {
      alert("Error al eliminar la mascota");
    }
  } catch (error) {
    console.error(error);
    alert("Error de conexi√≥n con la API");
  }
}

window.onload = cargarMascotas;
</script>

</body>
</html>
